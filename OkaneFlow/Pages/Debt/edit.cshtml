@page "{id:guid}"
@model OkaneFlow.Pages.Debt.editModel
@using OkaneFlow.Helpers.Enums
@{
    var prefs = ViewContext.HttpContext.Items["UserPreferences"] as UserPreferenceModel;
    var currencySymbol = FormatHelper.FormatCurrency(0, prefs?.Currency ?? "EUR").Substring(0, 1);
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-6" style="max-width: 600px;">
            <h2 class="text-primary fw-bold mb-4">Edit Debt</h2>
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <form method="post">
                        <input type="hidden" asp-for="Input.DebtID" />

                        <!-- Type Selection -->
                        <div class="mb-4 text-center">
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="Input.Type" id="type-liability"
                                    value="@DebtType.OwedByMe" @(Model.Input.Type == DebtType.OwedByMe ? "checked" : "")
                                    autocomplete="off" onchange="updateLabels()">
                                <label class="btn btn-outline-danger" for="type-liability">I Owe Money</label>

                                <input type="radio" class="btn-check" name="Input.Type" id="type-receivable"
                                    value="@DebtType.OwedToMe" @(Model.Input.Type == DebtType.OwedToMe ? "checked" : "")
                                    autocomplete="off" onchange="updateLabels()">
                                <label class="btn btn-outline-success" for="type-receivable">Owed To Me</label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.Name"
                                class="form-label text-secondary small fw-bold text-uppercase">Title</label>
                            <input asp-for="Input.Name" class="form-control" required />
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.AssociatedEntity" id="entity-label"
                                class="form-label text-secondary small fw-bold text-uppercase">Lender/Borrower</label>
                            <input asp-for="Input.AssociatedEntity" class="form-control" />
                        </div>

                        <div class="row">
                            <div class="col-6 mb-3">
                                <label asp-for="Input.InitialAmount"
                                    class="form-label text-secondary small fw-bold text-uppercase">Initial
                                    Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0">@currencySymbol</span>
                                    <input asp-for="Input.InitialAmount" class="form-control border-start-0 ps-0"
                                        type="number" step="0.01" required />
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <label asp-for="Input.RemainingAmount"
                                    class="form-label text-secondary small fw-bold text-uppercase">Remaining</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0">@currencySymbol</span>
                                    <input asp-for="Input.RemainingAmount" class="form-control border-start-0 ps-0"
                                        type="number" step="0.01" required />
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.AccountID"
                                class="form-label text-secondary small fw-bold text-uppercase">Linked Account
                                (Optional)</label>
                            <select asp-for="Input.AccountID" asp-items="Model.Accounts" class="form-select">
                                <option value="">-- Standalone --</option>
                            </select>
                        </div>

                        <div class="mb-3 bg-light p-3 rounded">
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" asp-for="Input.IsInterestEnabled"
                                    id="interest-toggle" onchange="toggleInterest()">
                                <label class="form-check-label fw-bold" for="interest-toggle">Enable Interest</label>
                            </div>
                            <div id="interest-field" style="display:none;">
                                <label asp-for="Input.InterestRate"
                                    class="form-label text-secondary small fw-bold text-uppercase">Interest Rate
                                    (%)</label>
                                <input asp-for="Input.InterestRate" class="form-control" type="number" step="0.1" />
                            </div>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Input.DueDate"
                                class="form-label text-secondary small fw-bold text-uppercase">Due Date</label>
                            <input asp-for="Input.DueDate" class="form-control" type="date" required />
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">Save Changes</button>
                            <button type="button" onclick="history.back()"
                                class="btn btn-light text-secondary">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function updateLabels() {
        const isLiability = document.getElementById('type-liability').checked;
        const entityLabel = document.getElementById('entity-label');
        if (entityLabel) {
            entityLabel.textContent = isLiability ? 'Lender (Who do you owe?)' : 'Borrower (Who owes you?)';
        }
    }

    function toggleInterest() {
        const isEnabled = document.getElementById('interest-toggle').checked;
        const field = document.getElementById('interest-field');
        if (field) {
            field.style.display = isEnabled ? 'block' : 'none';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        updateLabels();
        toggleInterest();
    });
</script>
