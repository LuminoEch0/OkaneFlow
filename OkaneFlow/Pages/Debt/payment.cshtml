@page "{id:guid}"
@model OkaneFlow.Pages.Debt.paymentModel
@{
    ViewData["Title"] = "Record Payment";
    var prefs = ViewContext.HttpContext.Items["UserPreferences"] as UserPreferenceModel;
    var currency = prefs?.Currency ?? "EUR";
    var currencySymbol = FormatHelper.FormatCurrency(0, currency).Substring(0, 1);
}

<div class="container py-4" style="max-width: 500px;">
    <div class="card shadow-sm">
        <div class="card-header bg-white py-3">
            <h5 class="mb-0 fw-bold">Record Payment</h5>
        </div>
        <div class="card-body p-4">
            <dl class="row mb-4">
                <dt class="col-sm-4 text-secondary">Debt Title</dt>
                <dd class="col-sm-8 fw-bold">@Model.Debt.Name</dd>

                <dt class="col-sm-4 text-secondary">Balance</dt>
                <dd class="col-sm-8">@FormatHelper.FormatCurrency(Model.Debt.RemainingAmount, currency)</dd>

                @if (Model.Debt.AccountID.HasValue)
                {
                    <dt class="col-sm-4 text-secondary">Linked Account</dt>
                    <dd class="col-sm-8">@Model.AccountName</dd>
                }
            </dl>

            <form method="post">
                <div class="mb-3">
                    <label asp-for="PaymentAmount"
                        class="form-label text-secondary small fw-bold text-uppercase">Payment Amount</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">@currencySymbol</span>
                        <input asp-for="PaymentAmount" class="form-control" type="number" step="0.01"
                            max="@Model.Debt.RemainingAmount" required />
                    </div>
                    <span asp-validation-for="PaymentAmount" class="text-danger"></span>
                </div>

                @if (Model.Debt.AccountID.HasValue)
                {
                    <div class="mb-4 bg-light p-3 rounded">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" asp-for="CreateTransaction">
                            <label class="form-check-label" asp-for="CreateTransaction">Create Transaction in
                                @Model.AccountName</label>
                        </div>
                        <div class="form-text small mt-2">
                            This will automatically create an @(Model.Debt.Type == OkaneFlow.Helpers.Enums.DebtType.OwedByMe
                        ? "Expense" : "Income") transaction to update your bank balance.
                        </div>
                    </div>
                }

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary px-4">Record Payment</button>
                    <a asp-page="/Debt/DebtPage" class="btn btn-outline-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>
